DEBUG=0

VPATH=./sfrl/
EXEC=sfrl_obj
OBJDIR=./obj/

CC=gcc
OPTS=-Ofast
LDFLAGS= -lm -pthread 
COMMON= 
CFLAGS=-Wall -Wfatal-errors 

ifeq ($(DEBUG), 1) 
OPTS=-O0 -g
endif

CFLAGS+=$(OPTS)

OBJ=softmax_layer.o iris.o blas.o activation.o optimizer.o network.o base_layer.o batchnorm_layer.o dense_layer.o loss_layer.o metric.o data.o loader.o

all: obj backup results $(EXEC)

sfrl_obj : $(OBJ)
	cc -o  sfrl_obj $(OBJ)

softmax_layer.o : ./sfrl/layer/softmax_layer.h
iris.o : ./sfrl/loader/loader.h
blas.o : ./sfrl/utils/blas.h
activation.o : ./sfrl/activation/activation.h
optimizer.o : ./sfrl/optimizer/optimizer.h
network.o : ./sfrl/network/network.h
base_layer.o : ./sfrl/layer/base_layer.h
batchnorm_layer.o : ./sfrl/layer/batchnorm_layer.h
dense_layer.o : ./sfrl/layer/dense_layer.h
loss_layer.o : ./sfrl/layer/loss_layer.h
metric.o : ./sfrl/metric/metric.h
data.o : ./sfrl/data/data.h
loader.o : ./sfrl/loader/loader.h



# OBJS = $(addprefix $(OBJDIR), $(OBJ))
# DEPS = $(wildcard ./sfrl/*/*.h) Makefile

# all: obj backup results $(EXEC)

# $(EXEC): $(OBJS)
# 	$(CC) $(COMMON) $(CFLAGS) $^ -o $@ $(LDFLAGS)

# $(OBJDIR)%.o: $(DEPS)
# 	$(CC) $(COMMON) $(CFLAGS) -c $< -o $@

obj:
	mkdir -p obj
backup:
	mkdir -p backup
results:
	mkdir -p results

.PHONY: clean

clean:
	rm -rf $(OBJS) $(EXEC)

